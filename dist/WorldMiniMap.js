import{Control as t,Map as i,DomUtil as o,DomEvent as n}from"leaflet";let defaultOptions={position:"bottomleft",width:168,height:84,view:"auto",lineWidth:2,lineColor:"white",circleRadius:3,circleColor:"white",map:"https://cdn.jsdelivr.net/gh/maneoverland/leaflet.WorldMiniMap@master/WorldMap.svg",containerStyle:{backgroundColor:"#919eac",border:"2px solid black",borderRadius:"5px",padding:"3px"}};export class WorldMiniMap extends t{#a=null;#b=null;#c=null;#d=null;constructor(t){super(defaultOptions),this.setOptions(t),this.#b=o.create("canvas","leaflet-control-worldminimap"),n.disableClickPropagation(this.#b),n.on(this.#b,"mousewheel",n.stopPropagation),this.#c=this.#b.getContext("2d"),this.#d=new Image}setOptions(t){"object"!=typeof t&&(t={containerStyle:{}}),"object"!=typeof t.containerStyle&&(t.containerStyle={});var i={...this.options.containerStyle,...t.containerStyle};this.options={...this.options,...t},this.options.containerStyle=i,null!==this.#a&&this.addTo(this.#a)}onAdd(t){var i=this;return this.#d.src=this.options.map,Object.assign(this.#b.style,this.options.containerStyle),this.#b.style.visibility="hidden",this.#d.onload=function(){i.options.height>0&&(this.height=i.options.height),i.options.width>0&&(this.width=i.options.width),i.#b.height=this.height,i.#b.width=this.width,i.#b.style.height=this.height+"px",i.#b.style.width=this.width+"px",i.#b.style.visibility="visible",i.#e(t)},this.#a=t,t.on("moveend",this.#f,this),this.#b}onRemove(t){t.off("moveend",this.#f,this),this.#a=null}#f(s){this.#e(s.target)}#g(e,h,r){return Math.round((e/h+.5)*r)}#e(a){var l,d=this.#g(a.getBounds().getWest(),360,this.#b.width),c=this.#g(a.getBounds().getEast(),360,this.#b.width),p=this.#g(a.getBounds().getNorth(),-180,this.#b.height),M=this.#g(a.getBounds().getSouth(),-180,this.#b.height),g=this.options.lineWidth/2;p<g&&(p=g),M>this.#b.height-g&&(M=this.#b.height-g),M-p<this.options.lineWidth&&(M=p+this.options.lineWidth),c-d>this.#b.width?(d=g,c=this.#b.width-g):((l=d%this.#b.width)<0&&(l+=this.#b.width),l-=d,d+=l,c+=l),c-d<this.options.lineWidth&&(c=d+this.options.lineWidth),this.#c.clearRect(0,0,this.#b.width,this.#b.height),this.#c.drawImage(this.#d,0,0,this.#b.width,this.#b.height),((c-d>2*this.options.circleRadius||M-p>2*this.options.circleRadius)&&"auto"==this.options.view||"both"==this.options.view||"square"==this.options.view)&&(this.#c.beginPath(),this.#c.lineWidth=this.options.lineWidth,this.#c.strokeStyle=this.options.lineColor,this.#c.rect(d,p,c-d,M-p),this.#c.stroke(),c>this.#b.width&&(this.#c.rect(d-this.#b.width,p,c-d,M-p),this.#c.stroke())),(c-d<=2*this.options.circleRadius&&M-p<=2*this.options.circleRadius&&"auto"==this.options.view||"both"==this.options.view||"circle"==this.options.view)&&(this.#c.fillStyle=this.options.circleColor,this.#c.beginPath(),this.#c.arc((d+c)*.5,(p+M)*.5,this.options.circleRadius,0,2*Math.PI),this.#c.fill())}}i.mergeOptions({worldMiniMapControl:!1}),i.addInitHook(function(){this.options.worldMiniMapControl&&(this.worldMiniMapControl=new WorldMiniMap().addTo(this))});